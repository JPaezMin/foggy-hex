import{g as ee,e as te,m as ae,l as se,q as C,s as ne,h as w,c as i,a as r,i as re,t as g,F as k,r as G,o as l,d as oe}from"#entry";import{u as ce,q as ie}from"./BhfrXJPj.js";const le={class:"relative container mx-auto px-6 py-16 space-y-16 text-left"},de={class:"space-y-8 w-full","aria-labelledby":"agenda-upcoming"},ue={key:0,class:"font-sans text-center text-base text-text/70 border border-dashed border-text/40 py-4"},pe={key:1,class:"font-sans text-center text-base text-text/70 border border-dashed border-text/40 py-4"},me={key:2,class:"grid gap-8 sm:grid-cols-2 lg:grid-cols-3 w-full"},ge={class:"space-y-2"},fe={class:"font-mono text-xs uppercase tracking-[0.6em] text-text/60"},he={class:"font-heading text-2xl leading-snug"},xe={class:"font-sans text-sm text-text/80"},be={class:"space-y-3 font-sans text-sm"},ye={class:"flex items-center gap-2"},Ne={class:"flex-1"},_e={class:"text-text/80"},we=["href"],De={key:3,class:"font-sans text-center text-base text-text/70 border border-dashed border-text/40 py-8"},Ie={key:0,class:"space-y-6","aria-labelledby":"agenda-archived"},Ae={class:"grid gap-4 md:grid-cols-2"},Te={class:"font-mono text-[11px] uppercase tracking-[0.5em] text-text/60"},Ee={class:"font-heading text-lg text-text"},ve={class:"font-sans text-sm text-text/70"},P="c_1b9e4111ecdffe96f6d9e657a6b061386b05f3e5fc93de1f9a482e5a7b1cb485@group.calendar.google.com",Ce="/api/agenda/ics",Re=ee({__name:"agenda",async setup(ke){let b,L;te({title:"Nos verémos en... | Foggy Hex",description:"Agenda viva de conciertos y citas afines en los espacios donde Foggy Hex colabora habitualmente.",ogTitle:"Nos verémos en... | Foggy Hex",ogDescription:"Agenda viva de conciertos y citas afines en los espacios donde Foggy Hex colabora habitualmente.",ogImage:"https://www.foggyhexbcn.com/about-og.jpg",ogUrl:"https://www.foggyhexbcn.com/agenda"});const S=ae(),R=S.public?.googleCalendarApiKey??S.public?.GOOGLE_CALENDAR_API_KEY??"",D=`https://calendar.google.com/calendar/embed?src=${encodeURIComponent(P)}&mode=AGENDA`,{data:H}=([b,L]=se(()=>ce("agenda-events",()=>ie("agenda").order("date","ASC").all())),b=await b,L(),b),I=C([]),A=C(!0),x=C(null),T=new Date,$=new Date(T.getFullYear(),T.getMonth(),T.getDate()),U=e=>{if(!e)return null;const t=e.trim();if(!t)return null;if(/^\d{4}-\d{2}-\d{2}/.test(t)){const s=(t.split("T")[0]??"").split("-").map(c=>c.trim());if(s.length===3){const[c,o,p]=s,d=Number.parseInt(c,10),m=Number.parseInt(o,10),u=Number.parseInt(p,10);if(Number.isInteger(d)&&Number.isInteger(m)&&Number.isInteger(u)){const f=new Date(d,m-1,u);if(!Number.isNaN(f.getTime()))return f}}}if(/^\d{1,2}\/\d{1,2}\/\d{2,4}$/.test(t)){const n=t.split("/").map(s=>s.trim());if(n.length===3){const[s,c,o]=n;if(!s||!c||!o)return null;const p=Number.parseInt(s,10),d=Number.parseInt(c,10),m=Number.parseInt(o.length===2?`20${o}`:o,10);if(Number.isInteger(m)&&Number.isInteger(d)&&Number.isInteger(p)){const u=new Date(m,d-1,p);if(!Number.isNaN(u.getTime()))return u}}}const a=new Date(t);return Number.isNaN(a.getTime())?null:a},q=e=>{if(!e)return"";const t=e instanceof Date?e:U(e);if(!t)return typeof e=="string"?e:"";const a=String(t.getDate()).padStart(2,"0"),n=String(t.getMonth()+1).padStart(2,"0"),s=String(t.getFullYear());return`${a}/${n}/${s}`},j=(e,t,a)=>{if(a)return a;if(!e)return"Por confirmar";if(t)return"Todo el diaa";const n=String(e.getHours()).padStart(2,"0"),s=String(e.getMinutes()).padStart(2,"0");return`${n}:${s}`},h=e=>e?e.replace(/\\n/g," ").replace(/\\\\/g,"\\").replace(/\\,/g,", ").replace(/\s+/g," ").trim():"",F=e=>{const t=h(e);return t?t.split(" ").map(a=>a?a.charAt(0).toUpperCase()+a.slice(1).toLowerCase():"").join(" "):""},K=e=>{if(!e)return null;const t=e.match(/https?:\/\/[^\s<>"']+/);return t?.[0]?t[0].replace(/[),.;]+$/,""):null},M=e=>K(e.description)??(e.url||null),V=e=>F(e.title),z=e=>e.replace(/\r?\n[ \t]/g,""),Z=e=>{if(!e)return{date:null,allDay:!1};if(/^\d{8}$/.test(e)){const n=Number.parseInt(e.slice(0,4),10),s=Number.parseInt(e.slice(4,6),10)-1,c=Number.parseInt(e.slice(6,8),10),o=new Date(Date.UTC(n,s,c));return{date:Number.isNaN(o.getTime())?null:o,allDay:!0}}const t=e.match(/^(\d{4})(\d{2})(\d{2})T(\d{2})(\d{2})(\d{2})(Z)?$/);if(t){const[,n,s,c,o,p,d,m]=t,u=Number.parseInt(n,10),f=Number.parseInt(s,10)-1,y=Number.parseInt(c,10),N=Number.parseInt(o,10),E=Number.parseInt(p,10),_=Number.parseInt(d,10),v=m?new Date(Date.UTC(u,f,y,N,E,_)):new Date(u,f,y,N,E,_);return{date:Number.isNaN(v.getTime())?null:v,allDay:!1}}const a=new Date(e);return{date:Number.isNaN(a.getTime())?null:a,allDay:!1}},W=e=>z(e).split("BEGIN:VEVENT").slice(1).map((n,s)=>{const c=n.split("END:VEVENT")[0]??"",o=_=>c.match(new RegExp(`${_}[^:]*:([^\\r\\n]+)`))?.[1]??"",p=o("DTSTART"),{date:d,allDay:m}=Z(p);if(!d)return null;const u=o("URL"),f=o("SUMMARY")||"Evento sin título",y=h(o("LOCATION")),N=h(o("DESCRIPTION"));return{id:o("UID")||`${f}-${p}-${s}`,title:f,date:d,location:y,description:N,url:u||D,allDay:m}}).filter(Boolean),J=e=>(e||[]).map((t,a)=>{const n=t.start?.dateTime||t.start?.date;if(!n)return null;const s=!!(t.start?.date&&!t.start?.dateTime),c=new Date(n);return Number.isNaN(c.getTime())?null:{id:t.id||`api-${a}`,title:t.summary||"Evento sin título",date:c,location:h(t.location),description:h(t.description||t.organizer?.displayName),url:t.htmlLink||t.source?.url||D,allDay:s}}).filter(Boolean),Q=async()=>{const e=[async()=>{const n=await fetch(Ce,{headers:{Accept:"text/calendar"}});if(!n.ok)throw new Error("No se pudo cargar la agenda desde el proxy ICS");const s=await n.text();return W(s)}];R&&e.push(async()=>{const n=new URLSearchParams({timeMin:"2026-01-01T00:00:00Z",timeMax:"2027-01-01T00:00:00Z",singleEvents:"true",orderBy:"startTime",showDeleted:"false",maxResults:"2500",key:R}),s=`https://www.googleapis.com/calendar/v3/calendars/${encodeURIComponent(P)}/events?${n.toString()}`,c=await fetch(s);if(!c.ok)throw new Error("No se pudo cargar la agenda via Google Calendar API");const o=await c.json();return J(o.items)});let t=!1,a=null;try{for(const n of e)try{const s=await n();if(I.value=s,t=!0,s.length)return}catch(s){a=s}}catch(n){a=n}finally{A.value=!1}if(t){x.value=null;return}a?(console.error("Agenda fetch error",a),x.value="No pudimos cargar la agenda en vivo. Revisa tu conexión, agrega GOOGLE_CALENDAR_API_KEY o vuelve a intentarlo."):x.value="No pudimos cargar la agenda en vivo. Intentaremos de nuevo más tarde."};ne(()=>{Q()});const X=w(()=>(H.value??[]).map(e=>({id:e.slug,title:F(e.title),date:U(e.date),location:h(e.venue),description:h(e.space),url:e.ticketUrl??e.infoUrl??e.source??D,allDay:!e.time,time:e.time})).filter(e=>!!e.date)),B=w(()=>I.value.length?I.value:X.value),O=w(()=>[...B.value].filter(e=>e.date?e.date>=$&&e.date.getFullYear()===2026:!1).sort((e,t)=>!e.date&&!t.date?e.title.localeCompare(t.title):e.date?t.date?e.date.getTime()-t.date.getTime():1:-1)),Y=w(()=>[...B.value].filter(e=>e.date?e.date<$&&e.date.getFullYear()===2026:!1).sort((e,t)=>!e.date||!t.date?0:t.date.getTime()-e.date.getTime()));return(e,t)=>(l(),i("article",le,[t[3]||(t[3]=r("header",{class:"max-w-4xl space-y-6"},[r("h1",{class:"font-heading text-[40px] leading-tight text-accent mb-4 border-l-4 border-text pl-4"}," Nos veremos en... "),r("div",{class:"font-sans text-lg leading-relaxed text-text space-y-4"},[r("p",null," Esta agenda reúne solo los eventos a los cuales nos encantaría ir. No hay pagos ni promos de por medio. Compartimos eventos a los que iríamos como público, por simple afinidad con la música y con lo que hacen les artistes, con especial atención -aunque no exclusiva- al tejido de salas y espacios autogestionados de nuestra ciudad. "),r("p",null," Si tienes un evento que crees que encaja, puedes escribirnos. Leemos todo, pero esto no es un tablón abierto: lo que aparece aquí responde únicamente a nuestros gustos y a la curiosidad del colectivo. "),r("p",null," Sabemos, por experiencia, que muchos eventos pequeños organizados por otros colectivos como el nuestro muchas veces se pierden en el eter del algoritmo, sin ninguna promoción de medios locales y esta agenda es solo nuestra forma de intentar amplificar un poco esas fechas dentro de nuestra propia comunidad. ")])],-1)),r("section",de,[t[1]||(t[1]=r("div",{class:"flex items-center gap-4"},[r("h2",{id:"agenda-upcoming",class:"font-heading text-3xl border-b-2 border-text pb-2"}," Agenda Local ")],-1)),x.value?(l(),i("p",ue,g(x.value),1)):A.value?(l(),i("p",pe," Cargando agenda 2026... ")):O.value.length?(l(),i("div",me,[(l(!0),i(k,null,G(O.value,a=>(l(),i("article",{key:a.id,class:"border border-text/30 bg-white p-6 flex flex-col gap-4 shadow-sm"},[r("div",ge,[r("p",fe,g(q(a.date)||"Fecha por definir"),1),r("h3",he,g(V(a)),1),r("p",xe,g(a.location||"Lugar por definir"),1)]),r("dl",be,[r("div",ye,[t[0]||(t[0]=r("dt",{class:"font-semibold whitespace-nowrap"},"Hora:",-1)),r("dd",Ne,g(j(a.date,a.allDay,a.time)),1)]),r("div",_e,[M(a)?(l(),i("a",{key:0,href:M(a),target:"_blank",rel:"noopener noreferrer",class:"text-accent underline decoration-inherit underline-offset-2"}," Entradas ",8,we)):(l(),i(k,{key:1},[oe(g(a.description||"Mas detalles pronto"),1)],64))])])]))),128))])):(l(),i("p",De," Aún no hay eventos confirmados para 2026. Vuelve pronto: el calendario se actualiza en cuanto añadimos nuevas fechas. "))]),!A.value&&Y.value.length?(l(),i("section",Ie,[t[2]||(t[2]=r("div",{class:"flex items-center gap-4"},[r("h2",{id:"agenda-archived",class:"font-heading text-3xl border-b-2 border-text pb-2"}," Registro reciente "),r("span",{class:"font-mono text-xs uppercase tracking-[0.4em] text-text/60"},"Archivo")],-1)),r("ul",Ae,[(l(!0),i(k,null,G(Y.value,a=>(l(),i("li",{key:`archived-${a.id}`,class:"border border-text/20 bg-white/70 px-5 py-4"},[r("p",Te,g(q(a.date)),1),r("p",Ee,g(V(a)),1),r("p",ve,g(a.location||"Lugar por definir"),1)]))),128))])])):re("",!0)]))}});export{Re as default};

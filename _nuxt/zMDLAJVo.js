import{g as ee,e as te,m as ae,l as se,q as C,s as ne,h as w,c as i,a as n,i as re,t as g,F as k,r as Y,o as l,d as oe}from"#entry";import{u as ce,q as ie}from"./BhfrXJPj.js";const le={class:"relative container mx-auto px-6 py-16 space-y-16 text-left"},de={class:"space-y-8 w-full","aria-labelledby":"agenda-upcoming"},ue={key:0,class:"font-sans text-center text-base text-text/70 border border-dashed border-text/40 py-4"},pe={key:1,class:"font-sans text-center text-base text-text/70 border border-dashed border-text/40 py-4"},me={key:2,class:"grid gap-8 sm:grid-cols-2 lg:grid-cols-3 w-full"},ge={class:"space-y-2"},fe={class:"font-mono text-xs uppercase tracking-[0.6em] text-text/60"},he={class:"font-heading text-2xl leading-snug"},xe={class:"font-sans text-sm text-text/80"},be={class:"space-y-3 font-sans text-sm"},ye={class:"flex items-center gap-2"},Ne={class:"flex-1"},_e={class:"text-text/80"},we=["href"],De={key:3,class:"font-sans text-center text-base text-text/70 border border-dashed border-text/40 py-8"},Ae={key:0,class:"space-y-6","aria-labelledby":"agenda-archived"},Ie={class:"grid gap-4 md:grid-cols-2"},Te={class:"font-mono text-[11px] uppercase tracking-[0.5em] text-text/60"},Ee={class:"font-heading text-lg text-text"},ve={class:"font-sans text-sm text-text/70"},G="c_1b9e4111ecdffe96f6d9e657a6b061386b05f3e5fc93de1f9a482e5a7b1cb485@group.calendar.google.com",Ce="/api/agenda/ics",Re=ee({__name:"agenda",async setup(ke){let b,L;te({title:"Nos verémos en... | Foggy Hex",description:"Agenda viva de conciertos y citas afines en los espacios donde Foggy Hex colabora habitualmente.",ogTitle:"Nos verémos en... | Foggy Hex",ogDescription:"Agenda viva de conciertos y citas afines en los espacios donde Foggy Hex colabora habitualmente.",ogImage:"https://www.foggyhexbcn.com/about-og.jpg",ogUrl:"https://www.foggyhexbcn.com/agenda"});const S=ae(),R=S.public?.googleCalendarApiKey??S.public?.GOOGLE_CALENDAR_API_KEY??"",D=`https://calendar.google.com/calendar/embed?src=${encodeURIComponent(G)}&mode=AGENDA`,{data:H}=([b,L]=se(()=>ce("agenda-events",()=>ie("agenda").order("date","ASC").all())),b=await b,L(),b),A=C([]),I=C(!0),x=C(null),T=new Date,$=new Date(T.getFullYear(),T.getMonth(),T.getDate()),q=e=>{if(!e)return null;const t=e.trim();if(!t)return null;if(/^\d{4}-\d{2}-\d{2}/.test(t)){const s=(t.split("T")[0]??"").split("-").map(c=>c.trim());if(s.length===3){const[c,o,p]=s,d=Number.parseInt(c,10),m=Number.parseInt(o,10),u=Number.parseInt(p,10);if(Number.isInteger(d)&&Number.isInteger(m)&&Number.isInteger(u)){const f=new Date(d,m-1,u);if(!Number.isNaN(f.getTime()))return f}}}if(/^\d{1,2}\/\d{1,2}\/\d{2,4}$/.test(t)){const r=t.split("/").map(s=>s.trim());if(r.length===3){const[s,c,o]=r;if(!s||!c||!o)return null;const p=Number.parseInt(s,10),d=Number.parseInt(c,10),m=Number.parseInt(o.length===2?`20${o}`:o,10);if(Number.isInteger(m)&&Number.isInteger(d)&&Number.isInteger(p)){const u=new Date(m,d-1,p);if(!Number.isNaN(u.getTime()))return u}}}const a=new Date(t);return Number.isNaN(a.getTime())?null:a},U=e=>{if(!e)return"";const t=e instanceof Date?e:q(e);if(!t)return typeof e=="string"?e:"";const a=String(t.getDate()).padStart(2,"0"),r=String(t.getMonth()+1).padStart(2,"0"),s=String(t.getFullYear());return`${a}/${r}/${s}`},j=(e,t,a)=>{if(a)return a;if(!e)return"Por confirmar";if(t)return"Todo el diaa";const r=String(e.getHours()).padStart(2,"0"),s=String(e.getMinutes()).padStart(2,"0");return`${r}:${s}`},h=e=>e?e.replace(/\\n/g," ").replace(/\\\\/g,"\\").replace(/\\,/g,", ").replace(/\s+/g," ").trim():"",F=e=>{const t=h(e);return t?t.split(" ").map(a=>a?a.charAt(0).toUpperCase()+a.slice(1).toLowerCase():"").join(" "):""},K=e=>{if(!e)return null;const t=e.match(/https?:\/\/[^\s<>"']+/);return t?.[0]?t[0].replace(/[),.;]+$/,""):null},M=e=>K(e.description)??(e.url||null),B=e=>F(e.title),Z=e=>e.replace(/\r?\n[ \t]/g,""),z=e=>{if(!e)return{date:null,allDay:!1};if(/^\d{8}$/.test(e)){const r=Number.parseInt(e.slice(0,4),10),s=Number.parseInt(e.slice(4,6),10)-1,c=Number.parseInt(e.slice(6,8),10),o=new Date(Date.UTC(r,s,c));return{date:Number.isNaN(o.getTime())?null:o,allDay:!0}}const t=e.match(/^(\d{4})(\d{2})(\d{2})T(\d{2})(\d{2})(\d{2})(Z)?$/);if(t){const[,r,s,c,o,p,d,m]=t,u=Number.parseInt(r,10),f=Number.parseInt(s,10)-1,y=Number.parseInt(c,10),N=Number.parseInt(o,10),E=Number.parseInt(p,10),_=Number.parseInt(d,10),v=m?new Date(Date.UTC(u,f,y,N,E,_)):new Date(u,f,y,N,E,_);return{date:Number.isNaN(v.getTime())?null:v,allDay:!1}}const a=new Date(e);return{date:Number.isNaN(a.getTime())?null:a,allDay:!1}},W=e=>Z(e).split("BEGIN:VEVENT").slice(1).map((r,s)=>{const c=r.split("END:VEVENT")[0]??"",o=_=>c.match(new RegExp(`${_}[^:]*:([^\\r\\n]+)`))?.[1]??"",p=o("DTSTART"),{date:d,allDay:m}=z(p);if(!d)return null;const u=o("URL"),f=o("SUMMARY")||"Evento sin título",y=h(o("LOCATION")),N=h(o("DESCRIPTION"));return{id:o("UID")||`${f}-${p}-${s}`,title:f,date:d,location:y,description:N,url:u||D,allDay:m}}).filter(Boolean),J=e=>(e||[]).map((t,a)=>{const r=t.start?.dateTime||t.start?.date;if(!r)return null;const s=!!(t.start?.date&&!t.start?.dateTime),c=new Date(r);return Number.isNaN(c.getTime())?null:{id:t.id||`api-${a}`,title:t.summary||"Evento sin título",date:c,location:h(t.location),description:h(t.description||t.organizer?.displayName),url:t.htmlLink||t.source?.url||D,allDay:s}}).filter(Boolean),Q=async()=>{const e=[async()=>{const r=await fetch(Ce,{headers:{Accept:"text/calendar"}});if(!r.ok)throw new Error("No se pudo cargar la agenda desde el proxy ICS");const s=await r.text();return W(s)}];R&&e.push(async()=>{const r=new URLSearchParams({timeMin:"2026-01-01T00:00:00Z",timeMax:"2027-01-01T00:00:00Z",singleEvents:"true",orderBy:"startTime",showDeleted:"false",maxResults:"2500",key:R}),s=`https://www.googleapis.com/calendar/v3/calendars/${encodeURIComponent(G)}/events?${r.toString()}`,c=await fetch(s);if(!c.ok)throw new Error("No se pudo cargar la agenda via Google Calendar API");const o=await c.json();return J(o.items)});let t=!1,a=null;try{for(const r of e)try{const s=await r();if(A.value=s,t=!0,s.length)return}catch(s){a=s}}catch(r){a=r}finally{I.value=!1}if(t){x.value=null;return}a?(console.error("Agenda fetch error",a),x.value="No pudimos cargar la agenda en vivo. Revisa tu conexión, agrega GOOGLE_CALENDAR_API_KEY o vuelve a intentarlo."):x.value="No pudimos cargar la agenda en vivo. Intentaremos de nuevo más tarde."};ne(()=>{Q()});const X=w(()=>(H.value??[]).map(e=>({id:e.slug,title:F(e.title),date:q(e.date),location:h(e.venue),description:h(e.space),url:e.ticketUrl??e.infoUrl??e.source??D,allDay:!e.time,time:e.time})).filter(e=>!!e.date)),V=w(()=>A.value.length?A.value:X.value),O=w(()=>[...V.value].filter(e=>e.date?e.date>=$&&e.date.getFullYear()===2026:!1).sort((e,t)=>!e.date&&!t.date?e.title.localeCompare(t.title):e.date?t.date?e.date.getTime()-t.date.getTime():1:-1)),P=w(()=>[...V.value].filter(e=>e.date?e.date<$&&e.date.getFullYear()===2026:!1).sort((e,t)=>!e.date||!t.date?0:t.date.getTime()-e.date.getTime()));return(e,t)=>(l(),i("article",le,[t[3]||(t[3]=n("header",{class:"max-w-4xl space-y-6"},[n("h1",{class:"font-heading text-[40px] leading-tight text-accent mb-4 border-l-4 border-text pl-4"}," Nos veremos en... "),n("div",{class:"font-sans text-lg leading-relaxed text-text space-y-4"},[n("p",null," Esta sección es simplemente una agenda de eventos que nos interesan de verdad. Aquí solo compartimos fechas que pasan en espacios auto-gestionados y fuera del circuito habitual de festivales y grandes promotores de Barcelona. No hay pagos, intercambios ni promos detrás. Publicamos conciertos, sesiones y encuentros a los que iríamos como público, porque nos gusta la música y nos interesa lo que hacen les artistas, independientemente de quién organice el evento. "),n("p",null," Si tienes un evento y crees que puede encajar, puedes escribirnos por email. Lo leemos todo, pero la agenda no funciona como un tablón abierto: lo que aparece aquí responde únicamente a los gustos y la curiosidad del colectivo. "),n("p",null," No pretendemos descubrir nada ni salvar ninguna escena. Como promotores independientes, simplemente sabemos que muchos eventos pequeños, experimentales o muy underground no suelen aparecer en los medios habituales. Esta web es nuestra forma de crear una pequeña cámara de eco para que esas fechas pasen desapercibidas por los miembros de nuestra comunidad. ")])],-1)),n("section",de,[t[1]||(t[1]=n("div",{class:"flex items-center gap-4"},[n("h2",{id:"agenda-upcoming",class:"font-heading text-3xl border-b-2 border-text pb-2"}," Agenda Local "),n("span",{class:"font-mono text-xs uppercase tracking-[0.4em] text-text/60"},"En curso")],-1)),x.value?(l(),i("p",ue,g(x.value),1)):I.value?(l(),i("p",pe," Cargando agenda 2026... ")):O.value.length?(l(),i("div",me,[(l(!0),i(k,null,Y(O.value,a=>(l(),i("article",{key:a.id,class:"border border-text/30 bg-white p-6 flex flex-col gap-4 shadow-sm"},[n("div",ge,[n("p",fe,g(U(a.date)||"Fecha por definir"),1),n("h3",he,g(B(a)),1),n("p",xe,g(a.location||"Lugar por definir"),1)]),n("dl",be,[n("div",ye,[t[0]||(t[0]=n("dt",{class:"font-semibold whitespace-nowrap"},"Hora:",-1)),n("dd",Ne,g(j(a.date,a.allDay,a.time)),1)]),n("div",_e,[M(a)?(l(),i("a",{key:0,href:M(a),target:"_blank",rel:"noopener noreferrer",class:"text-accent underline decoration-inherit underline-offset-2"}," Entradas ",8,we)):(l(),i(k,{key:1},[oe(g(a.description||"Mas detalles pronto"),1)],64))])])]))),128))])):(l(),i("p",De," Aún no hay eventos confirmados para 2026. Vuelve pronto: el calendario se actualiza en cuanto añadimos nuevas fechas. "))]),!I.value&&P.value.length?(l(),i("section",Ae,[t[2]||(t[2]=n("div",{class:"flex items-center gap-4"},[n("h2",{id:"agenda-archived",class:"font-heading text-3xl border-b-2 border-text pb-2"}," Registro reciente "),n("span",{class:"font-mono text-xs uppercase tracking-[0.4em] text-text/60"},"Archivo")],-1)),n("ul",Ie,[(l(!0),i(k,null,Y(P.value,a=>(l(),i("li",{key:`archived-${a.id}`,class:"border border-text/20 bg-white/70 px-5 py-4"},[n("p",Te,g(U(a.date)),1),n("p",Ee,g(B(a)),1),n("p",ve,g(a.location||"Lugar por definir"),1)]))),128))])])):re("",!0)]))}});export{Re as default};
